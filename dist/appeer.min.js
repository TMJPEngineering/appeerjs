!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription,b.exports.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,b.exports.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate},{}],2:[function(a,b,c){"use strict";function d(a,b){this.id=a||"",this.config=b||{},this.socket=null,this.remoteId=null,this.config.iceServers=[{url:"stun:stun.1.google.com:19302"}],this._pc=new RTCPeerConnection(b,{optional:[{RtpDataChannels:!0}]}),this._pc.onaddstream=this._handleAddStream.bind(this),this._pc.onicecandidate=this._handleIceCandidate.bind(this),this._initSocketIo(b.host+":"+b.port),this._handleMessages()}d.prototype._initSocketIo=function(a,b){var c=this;b=b||{},b.secure=!0,b.query="customId="+this.id,c.socket=io.connect(a,b),c.socket.on("error",function(a){c.emit("error",{error:a})})},d.prototype._handleAddStream=function(a){console.log("On add stream",a),this.emit("stream",{stream:a.stream})},d.prototype._handleIceCandidate=function(a){console.log("On Ice Candidate:",this.remoteId),a.candidate&&this.socket.emit("message",{type:"candidate",candidate:a.candidate,id:this.remoteId})},d.prototype.call=function(a,b){var c=this._pc,d=this.socket;this.remoteId=a,c.addStream(b),c.createOffer(function(b){console.log("Creating offer"),d.emit("message",{type:"offer",offer:b,id:a}),c.setLocalDescription(b)},function(a){console.log("Error on creating offer",a)})},d.prototype._handleMessages=function(){var a=this;a.socket.on("handle-message",function(b){switch(console.log("Got message",b),b.type){case"connect":a.emit("connection",{id:b.id});break;case"offer":console.log("Setting remote description on offer",b.offer),a._pc.setRemoteDescription(new RTCSessionDescription(b.offer)),a.emit("call",b);break;case"answer":a._handleAnswer(b.answer);break;case"candidate":a._handleCandidate(b.candidate);break;default:console.log(b.error)}})},d.prototype._handleOffer=function(a){var b=this._pc,c=this.socket;b.createAnswer(function(d){b.setLocalDescription(d),c.emit("message",{type:"answer",answer:d,id:a})},function(a){console.log("Error on create answer from offer",a)})},d.prototype._handleAnswer=function(a){console.log("Setting remote description on answer"),this._pc.setRemoteDescription(new RTCSessionDescription(a))},d.prototype._handleCandidate=function(a){console.log("Adding ice candidate",a),this._pc.addIceCandidate(new RTCIceCandidate(a))},d.prototype.answer=function(a,b){this.remoteId=a.id,this._pc.addStream(b),this._handleOffer(a.id)},d.prototype.emit=function(a,b){return window.dispatchEvent(new CustomEvent(a,{detail:b}))},d.prototype.on=function(a,b){window.addEventListener(a,b)},b.exports=d},{}],3:[function(a,b,c){window.Appeer=a("./appeer"),window.RTCPeerConnection=a("./adapter").RTCPeerConnection,window.RTCSessionDescription=a("./adapter").RTCSessionDescription,window.RTCIceCandidate=a("./adapter").RTCIceCandidate},{"./adapter":1,"./appeer":2}]},{},[3]);